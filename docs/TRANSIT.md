# GIIS-Signer - –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞](#—Ü–µ–ª—å-–ø—Ä–æ–µ–∫—Ç–∞)
- [–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å](#—Ç–µ–∫—É—â–∏–π-—Å—Ç–∞—Ç—É—Å)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Ä–µ—à—ë–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
- [–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è](#–∏–∑–≤–µ—Å—Ç–Ω—ã–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
- [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏)

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ-–≥–æ—Ç–æ–≤—É—é** Python-—É—Ç–∏–ª–∏—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è XML-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É **XMLDSig** —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ **–ì–ò–ò–° –î–ú–î–ö** (–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã—Ö –º–µ—Ç–∞–ª–ª–æ–≤ –∏ –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π), –∏—Å–ø–æ–ª—å–∑—É—è **–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP**.

### –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ SOAP XML-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ì–û–°–¢-–∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP —á–µ—Ä–µ–∑ COM-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Exclusive Canonicalization (ExcC14N)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É XMLDSig
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π CLI –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–µ–ª–∏–∑ v1.0.0 (2025-10-01)

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ!**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
- ‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ì–ò–ò–° –î–ú–î–ö –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ dss.cryptopro.ru)
- ‚úÖ –í—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ DigestValue –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (Base64)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ì–ò–ò–° –î–ú–î–ö

### –°—Ç–∞—Ç—É—Å —Ñ—É–Ω–∫—Ü–∏–π

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------|--------|------------|
| –ü–æ–∏—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ thumbprint –∏–ª–∏ subject |
| –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞ –ì–û–°–¢ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ì–û–°–¢ –† 34.11-2012 (256 –±–∏—Ç) |
| –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –ì–û–°–¢ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ì–û–°–¢ –† 34.10-2012 (256 –±–∏—Ç) |
| ExcC14N –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Exclusive Canonicalization 1.0 |
| SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | urn://smev-gov-ru/xmldsig/transform |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ XMLDSig | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Signature |
| CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ |
| –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
giis-signer/
‚îú‚îÄ‚îÄ giis_signer/                    # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # –ü—É–±–ª–∏—á–Ω—ã–π API
‚îÇ   ‚îú‚îÄ‚îÄ cli.py                      # CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
‚îÇ   ‚îú‚îÄ‚îÄ cryptopro_signer.py         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP
‚îÇ   ‚îú‚îÄ‚îÄ xml_signer.py               # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ XMLDSig –ø–æ–¥–ø–∏—Å–∏
‚îÇ   ‚îú‚îÄ‚îÄ exc_c14n_module/            # ExcC14N –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transform.py
‚îÇ   ‚îî‚îÄ‚îÄ smev_transform/             # SMEV —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ transform.py
‚îú‚îÄ‚îÄ examples/                       # –ü—Ä–∏–º–µ—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ template.xml                # –ë–∞–∑–æ–≤—ã–π SOAP-—à–∞–±–ª–æ–Ω
‚îÇ   ‚îî‚îÄ‚îÄ example_rq_1c.xml           # –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ 1–°
‚îú‚îÄ‚îÄ tests/                          # –¢–µ—Å—Ç—ã –∏ –æ—Ç–ª–∞–¥–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_com.py                 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ COM
‚îÇ   ‚îú‚îÄ‚îÄ debug_tools.py              # –ï–¥–∏–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_body_transform.py      # –¢–µ—Å—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π body
‚îÇ   ‚îú‚îÄ‚îÄ test_smev_transform.py      # –¢–µ—Å—Ç SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ verify_signaturevalue.py    # –ü—Ä–æ–≤–µ—Ä–∫–∞ SignatureValue
‚îú‚îÄ‚îÄ docs/                           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ DEVELOPMENT.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ CRYPTOPRO_COM.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è COM-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ SMEV.md                     # SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ SMEV_TESTS.md               # –¢–µ—Å—Ç—ã SMEV
‚îú‚îÄ‚îÄ pyproject.toml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ README.md                       # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ LICENSE                         # MIT License
‚îî‚îÄ‚îÄ .gitignore                      # –ò—Å–∫–ª—é—á–µ–Ω–∏—è Git
```

### –ú–æ–¥—É–ª–∏

#### 1. `cryptopro_signer.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP —á–µ—Ä–µ–∑ COM-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ö–ª–∞—Å—Å:** `CryptoProSigner`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ–∏—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Windows –ø–æ thumbprint –∏–ª–∏ subject
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞ –ì–û–°–¢ –† 34.11-2012 (256 –±–∏—Ç)
- –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ö–µ—à–∞ —Å –ì–û–°–¢ –† 34.10-2012 (256 –±–∏—Ç)
- –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ Base64
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HEX ‚Üî Base64

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç COM-–æ–±—ä–µ–∫—Ç—ã: `CAdESCOM.Store`, `CAdESCOM.HashedData`, `CAdESCOM.RawSignature`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è thumbprint (—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤, uppercase)
- **–†–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏:** `signature_bytes[::-1]` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ö–µ—à–∞:** –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HEX, –¥–ª—è XMLDSig —Ç—Ä–µ–±—É–µ—Ç—Å—è Base64

**COM-–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```python
CAPICOM_CURRENT_USER_STORE = 2
CAPICOM_STORE_OPEN_READ_ONLY = 0
CAPICOM_CERTIFICATE_FIND_SHA1_HASH = 0
CADESCOM_HASH_ALGORITHM_CP_GOST_3411_2012_256 = 101
CADESCOM_BASE64_TO_BINARY = 1
```

#### 2. `xml_signer.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ XML-–ø–æ–¥–ø–∏—Å–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ XMLDSig

**–ö–ª–∞—Å—Å:** `XMLSigner`

**–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è:**
1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞** - –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å `id="body"` –≤ SOAP
2. **ExcC14N –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —ç–ª–µ–º–µ–Ω—Ç—É body
3. **SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è** - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –≥–æ—Å—Å–∏—Å—Ç–µ–º
4. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ DigestValue** - —Ö–µ—à –ì–û–°–¢ –† 34.11-2012 –≤ Base64
5. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ SignedInfo** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Å xmlns:ds –¥–ª—è –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏)
6. **–ö–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è SignedInfo** - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ExcC14N
7. **–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ SignedInfo** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
8. **–†–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
9. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Signature** - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è XML-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–±–µ–∑ xmlns:ds, —Ç.–∫. –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è)
10. **–í—Å—Ç–∞–≤–∫–∞ –≤ SOAP** - —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–º–µ–Ω–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥–ø–∏—Å–∏:**
```xml
<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#" Id="signature-xxx">
  <ds:SignedInfo>
    <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
    <ds:SignatureMethod Algorithm="urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr34102012-gostr34112012-256"/>
    <ds:Reference URI="#body">
      <ds:Transforms>
        <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
        <ds:Transform Algorithm="urn://smev-gov-ru/xmldsig/transform"/>
      </ds:Transforms>
      <ds:DigestMethod Algorithm="urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr34112012-256"/>
      <ds:DigestValue>BASE64_HASH</ds:DigestValue>
    </ds:Reference>
  </ds:SignedInfo>
  <ds:SignatureValue>BASE64_SIGNATURE</ds:SignatureValue>
  <ds:KeyInfo>
    <ds:X509Data>
      <ds:X509Certificate>BASE64_CERT</ds:X509Certificate>
    </ds:X509Data>
  </ds:KeyInfo>
</ds:Signature>
```

#### 3. `cli.py` (ex-main.py)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–ö–æ–º–∞–Ω–¥–∞:** `giis-signer`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `input` - –ø—É—Ç—å –∫ XML-—à–∞–±–ª–æ–Ω—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
- `-o, --output` - –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `-t, --thumbprint` - –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ SHA1 (–æ–¥–∏–Ω –∏–∑ -t/-s –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- `-s, --subject` - –∏–º—è —Å—É–±—ä–µ–∫—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–æ–¥–∏–Ω –∏–∑ -t/-s –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- `-e, --element-id` - ID —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `body`)
- `-n, --signature-element` - –∏–º—è —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–¥–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `CallerSignature`)

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
giis-signer template.xml -t c755d5b4b7e1554b632f0c989427eba47b176c3a -o signed.xml

# –ü–æ –∏–º–µ–Ω–∏ —Å—É–±—ä–µ–∫—Ç–∞
giis-signer template.xml -s "CN=–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" -o signed.xml

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
giis-signer input.xml -t <thumbprint> -e "RequestBody" -n "Signature" -o output.xml
```

#### 4. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏

##### `exc_c14n_module/`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **Exclusive Canonicalization 1.0**
- –ê–ª–≥–æ—Ä–∏—Ç–º: `http://www.w3.org/2001/10/xml-exc-c14n#`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ body –∏ SignedInfo
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö–µ—à–µ–π

##### `smev_transform/`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**
- –ê–ª–≥–æ—Ä–∏—Ç–º: `urn://smev-gov-ru/xmldsig/transform`
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≥–æ—Å—Å–∏—Å—Ç–µ–º (–°–ú–≠–í)
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ ExcC14N –ø–µ—Ä–µ–¥ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

#### `diagnostics.py`
–ï–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–∞–∫–µ—Ç–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ:** `python -m giis_signer.diagnostics --check-cryptopro`
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–∏:** `python -m giis_signer.diagnostics --check-signature signed.xml`
- **–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** `python -m giis_signer.diagnostics --check-signature signed.xml --full`

**–§—É–Ω–∫—Ü–∏–∏:**
- `check_cryptopro_available()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ COM-–æ–±—ä–µ–∫—Ç–æ–≤
- `list_certificates()` - —Å–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- `check_signature(xml_file, verbose)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ XML-–ø–æ–¥–ø–∏—Å–∏
- `SignatureChecker` - –∫–ª–∞—Å—Å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–î–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∫–æ–¥–∞:**
```python
from giis_signer import check_cryptopro_available, check_signature

if check_cryptopro_available():
    is_valid = check_signature("signed.xml", verbose=True)
```

## –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è COM-–æ–±—ä–µ–∫—Ç–∞ Store
**–î–∞—Ç–∞:** –ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–∏–º–ø—Ç–æ–º:** `(-2147221005, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è —Å—Ç—Ä–æ–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–ª–∞—Å—Å–∞', None, None)`

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ProgID –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ COM-–æ–±—ä–µ–∫—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–±–æ–≤–∞—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: `CAdESCOM.Store` –∏ `CAPICOM.Store`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –≤–µ—Ä—Å–∏—é –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP (—Ç—Ä–µ–±—É–µ—Ç—Å—è 4.0+)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
**–î–∞—Ç–∞:** –ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–∏–º–ø—Ç–æ–º:** `–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω` –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º thumbprint

**–ü—Ä–∏—á–∏–Ω—ã:**
- Thumbprint —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏–ª–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `ValidOnly` –≤ –º–µ—Ç–æ–¥–µ `Find()`

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è thumbprint
self.thumbprint = thumbprint.replace(" ", "").upper() if thumbprint else None

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ Find
certificates = certificates.Find(
    CAPICOM_CERTIFICATE_FIND_SHA1_HASH,
    self.thumbprint,
    False  # ValidOnly = False (–≤–∞–∂–Ω–æ: –Ω–µ True –∏–ª–∏ 0!)
)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ì–ò–ò–° –î–ú–î–ö –∫–æ–¥ –æ—à–∏–±–∫–∏ -2 (–Ω–µ—Ç DigestValue)
**–î–∞—Ç–∞:** –°–µ—Ä–µ–¥–∏–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–∏–º–ø—Ç–æ–º:** DigestValue –≤ HEX —Ñ–æ—Ä–º–∞—Ç–µ –≤–º–µ—Å—Ç–æ Base64

**–ü—Ä–∏—á–∏–Ω–∞:** –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö–µ—à –≤ HEX —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `HashedData.Value`

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ–ª—É—á–∞–µ–º —Ö–µ—à –≤ HEX –æ—Ç –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
hash_hex = hasher.Value

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º HEX ‚Üí Base64 –¥–ª—è XMLDSig
hash_bytes = bytes.fromhex(hash_hex)
hash_base64 = base64.b64encode(hash_bytes).decode('ascii')
```

**–î–æ:** `B5A6221E42BEB71B822BBCD3CC8140DE11EFF076D4B72FFF7456DCFB60169F73` (64 —Å–∏–º–≤–æ–ª–∞, HEX)
**–ü–æ—Å–ª–µ:** `taYiHkK+txuCK7zTzIFA3hHv8HbUty//dFbc+2AWn3M=` (44 —Å–∏–º–≤–æ–ª–∞, Base64) ‚úÖ

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–∞–º–æ–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è —Ç–µ–≥–∏ –≤ SignedInfo
**–î–∞—Ç–∞:** –°–µ—Ä–µ–¥–∏–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–∏–º–ø—Ç–æ–º:** `<ds:CanonicalizationMethod ... />` –≤–º–µ—Å—Ç–æ `<ds:CanonicalizationMethod...></ds:CanonicalizationMethod>`

**–ü—Ä–∏—á–∏–Ω–∞:**
1. XML-—à–∞–±–ª–æ–Ω —Å–æ–¥–µ—Ä–∂–∞–ª —Å–∞–º–æ–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è —Ç–µ–≥–∏
2. `ElementTree.tostring()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞–∫ self-closing

**–†–µ—à–µ–Ω–∏–µ:**
1. **–í —à–∞–±–ª–æ–Ω–µ SignedInfo:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–º–æ–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è —Ç–µ–≥–∏ –ë–ï–ó –ü–†–û–ë–ï–õ–ê –ø–µ—Ä–µ–¥ `/>`:
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–ø–æ —ç—Ç–∞–ª–æ–Ω—É –ì–ò–ò–° –î–ú–î–ö):
<ds:CanonicalizationMethod Algorithm="..."/>  # –ë–µ–∑ –ø—Ä–æ–±–µ–ª–∞!

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
<ds:CanonicalizationMethod Algorithm="..." />  # –° –ø—Ä–æ–±–µ–ª–æ–º
```

2. **–ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –ø–æ–¥–ø–∏—Å–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –∑–∞–º–µ–Ω—É –≤–º–µ—Å—Ç–æ –ø–∞—Ä—Å–∏–Ω–≥–∞:
```python
# –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ElementTree (—Å–æ–∑–¥–∞—ë—Ç self-closing –ø–æ-—Å–≤–æ–µ–º—É):
# signature_element = ET.fromstring(signature_xml)
# caller_signature.append(signature_element)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å regex-–∑–∞–º–µ–Ω—É:
pattern = rf'<(\w+:)?{signature_element_name}(\s[^>]*)?>.*?</\1{signature_element_name}>'
result = re.sub(pattern, replace_func, soap_xml, flags=re.DOTALL)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ö–µ—à–∞ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
**–î–∞—Ç–∞:** –°–µ—Ä–µ–¥–∏–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `SetHashValue()` —Å Base64

**–ü—Ä–∏—á–∏–Ω–∞:** `SetHashValue()` –æ–∂–∏–¥–∞–µ—Ç HEX —Ñ–æ—Ä–º–∞—Ç, –∞ –Ω–µ Base64

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –î–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ SignedInfo –∏—Å–ø–æ–ª—å–∑—É–µ–º Base64:
digest_value_base64 = base64.b64encode(hash_bytes).decode('ascii')

# –î–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Base64 –æ–±—Ä–∞—Ç–Ω–æ –≤ HEX:
hash_bytes = base64.b64decode(hash_value)
hash_hex = hash_bytes.hex().upper()
hasher.SetHashValue(hash_hex)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å
**–î–∞—Ç–∞:** 2025-10-01
**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç—Å—Ç—É–ø–æ–≤ –≤ –ø–æ–¥–ø–∏—Å—å –ì–ò–ò–° –î–ú–î–ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–ü—Ä–∏—á–∏–Ω–∞:** –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤/–ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω—è–µ—Ç —Ö–µ—à —ç–ª–µ–º–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- **–ù–ï** —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π XML
- –í—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å—å –∫–∞–∫ –µ—Å—Ç—å, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤
- XML –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ—á–∏—Ç–∞–µ–º—ã–º, –Ω–æ –ø–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ XML
‚ö†Ô∏è **–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π XML –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å** - —ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∏.

–≠–ª–µ–º–µ–Ω—Ç `<ns:CallerSignature>` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥–ø–∏—Å—å –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É:
```xml
<ns:CallerSignature><ds:Signature ...>...</ds:Signature></ns:CallerSignature>
```

–≠—Ç–æ –Ω–µ–∫—Ä–∞—Å–∏–≤–æ, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∏.

### 2. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
‚ö†Ô∏è **–¢–æ–ª—å–∫–æ Windows** - –∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP COM-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

–ù–µ—Ç –ø–ª–∞–Ω–æ–≤ –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ Linux/macOS, —Ç–∞–∫ –∫–∞–∫ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ Windows.

### 3. –ê—Ç—Ä–∏–±—É—Ç id vs Id
‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–ª–µ–Ω—å–∫—É—é –±—É–∫–≤—É:** `id="body"` (–Ω–µ `Id` –∏–ª–∏ `ID`)

–ì–ò–ò–° –î–ú–î–ö —Å—Ç—Ä–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç `id` —Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã, —Ö–æ—Ç—è XMLDSig –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

### 4. –†–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏
‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–ï–ù —Ä–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏** - –±–µ–∑ –Ω–µ–≥–æ –ø–æ–¥–ø–∏—Å—å –Ω–µ –±—É–¥–µ—Ç –≤–∞–ª–∏–¥–Ω–æ–π.

–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –±–∞–π—Ç, —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏

```
1. –ß—Ç–µ–Ω–∏–µ SOAP XML
2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ id="body"
3. ExcC14N –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è body
4. SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
5. –•–µ—à –ì–û–°–¢ –† 34.11-2012 (256 –±–∏—Ç)
6. DigestValue = Base64(hash)
7. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ SignedInfo (–° xmlns:ds)
8. ExcC14N –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è SignedInfo
9. –•–µ—à –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SignedInfo
10. –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ö–µ—à–∞ —á–µ—Ä–µ–∑ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
11. –†–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏: signature[::-1]
12. SignatureValue = Base64(reversed_signature)
13. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Signature (–ë–ï–ó xmlns:ds –≤ SignedInfo)
14. –í—Å—Ç–∞–≤–∫–∞ –≤ CallerSignature (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–º–µ–Ω–∞)
15. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏—è |
|------------|----------|----------------------|
| **DigestValue —Ñ–æ—Ä–º–∞—Ç** | Base64 (–Ω–µ HEX!) | –ì–ò–ò–° –î–ú–î–ö –æ—à–∏–±–∫–∞ -2 |
| **–†–µ–≤–µ—Ä—Å –ø–æ–¥–ø–∏—Å–∏** | –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù | –ü–æ–¥–ø–∏—Å—å –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ |
| **–ü–æ—Ä—è–¥–æ–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π** | ExcC14N ‚Üí SMEV | –ù–µ–≤–µ—Ä–Ω—ã–π DigestValue |
| **–ê—Ç—Ä–∏–±—É—Ç id** | –ú–∞–ª–µ–Ω—å–∫–∞—è –±—É–∫–≤–∞: `id="body"` | –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω |
| **xmlns:ds –≤ SignedInfo** | –ù—É–∂–µ–Ω –¥–ª—è –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏, —É–±–∏—Ä–∞–µ—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª–µ | –ù–µ–≤–µ—Ä–Ω—ã–π —Ö–µ—à SignedInfo |
| **–°–∞–º–æ–∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è —Ç–µ–≥–∏** | –§–æ—Ä–º–∞—Ç `<tag/>` (–±–µ–∑ –ø—Ä–æ–±–µ–ª–∞) | –ú–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å –∫–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—é |
| **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ù–ï –º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è | –ù–∞—Ä—É—à–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å |

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ URI

| –û–ø–µ—Ä–∞—Ü–∏—è | –ê–ª–≥–æ—Ä–∏—Ç–º | URI |
|----------|----------|-----|
| **–ö–∞–Ω–æ–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è** | Exclusive C14N 1.0 | `http://www.w3.org/2001/10/xml-exc-c14n#` |
| **SMEV-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è** | SMEV Transform | `urn://smev-gov-ru/xmldsig/transform` |
| **–ü–æ–¥–ø–∏—Å—å** | –ì–û–°–¢ –† 34.10-2012 (256 –±–∏—Ç) | `urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr34102012-gostr34112012-256` |
| **–•–µ—à** | –ì–û–°–¢ –† 34.11-2012 (256 –±–∏—Ç) | `urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr34112012-256` |

### –§–æ—Ä–º–∞—Ç SOAP-–¥–æ–∫—É–º–µ–Ω—Ç–∞

**–í—Ö–æ–¥–Ω–æ–π —à–∞–±–ª–æ–Ω:**
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:ns="urn://xsd.dmdk.goznak.ru/exchange/3.0">
   <soapenv:Header/>
   <soapenv:Body>
      <ns:SendGetContractorRequest>
        <ns:CallerSignature></ns:CallerSignature>
        <ns:RequestData id="body">
           <ns:INN>7813252159</ns:INN>
        </ns:RequestData>
      </ns:SendGetContractorRequest>
   </soapenv:Body>
</soapenv:Envelope>
```

**–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:**
- `id="body"` - —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- `<ns:CallerSignature>` - —ç–ª–µ–º–µ–Ω—Ç, –∫—É–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å
- Namespace –ø—Ä–µ—Ñ–∏–∫—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–º–∏ (soapenv, ns, –∏ —Ç.–¥.)

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```toml
[project]
requires-python = ">=3.8"
dependencies = [
    "pywin32>=305",    # COM-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
    "lxml>=4.9.0",     # XML –æ–±—Ä–∞–±–æ—Ç–∫–∞
]
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **Windows OS** (–ª—é–±–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP)
- **–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ CSP 4.0+** (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ì–û–°–¢ –† 34.10-2012)
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ì–û–°–¢ –† 34.10-2012** (256 –±–∏—Ç) –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Windows

## –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
pip install -e .
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ
```bash
python -m giis_signer.diagnostics --check-cryptopro
```

### –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```bash
giis-signer examples/template.xml -t <thumbprint> -o signed.xml
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–∏
```bash
# –ö—Ä–∞—Ç–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python -m giis_signer.diagnostics --check-signature signed.xml

# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python -m giis_signer.diagnostics --check-signature signed.xml --full
```

## –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

### v1.0.0 (2025-10-01)
- ‚úÖ –ü–µ—Ä–≤—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑
- ‚úÖ –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ Python-–ø–∞–∫–µ—Ç
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README.md)
- ‚úÖ CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ entry point
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π API —á–µ—Ä–µ–∑ `__init__.py`
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ MIT License
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### v0.1.0 (–ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- ‚ö†Ô∏è –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ COM
- ‚ö†Ô∏è –û—à–∏–±–∫–∏ –ì–ò–ò–° –î–ú–î–ö —Ç—Ä–µ–±–æ–≤–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-01
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready - –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –ì–ò–ò–° –î–ú–î–ö —Ä–µ—à–µ–Ω—ã
