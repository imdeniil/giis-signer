# Файловая структура проекта GIIS Signer

Документ описывает организацию файлов и директорий в проекте.

## Корневая директория

```
giis-signer/
├── .venv/                      # Виртуальное окружение Python (создается через uv venv)
├── giis_signer/                # Основной пакет приложения
├── docs/                       # Документация проекта
├── examples/                   # Примеры использования
├── __pycache__/                # Кэш скомпилированных Python модулей (генерируется)
├── giis_signer.egg-info/       # Метаданные пакета (генерируется при установке)
├── .gitignore                  # Файлы/директории, игнорируемые Git
├── CLAUDE.md                   # Инструкции для Claude AI
├── LICENSE                     # MIT лицензия
├── main.py                     # Устаревший точка входа (для обратной совместимости)
├── pyproject.toml              # Конфигурация проекта и зависимостей
├── README.md                   # Основная документация проекта
├── smev_readme.md              # Документация по smev-transform пакету
└── uv.lock                     # Lockfile для uv package manager
```

## Пакет giis_signer/

Основной Python пакет с бизнес-логикой.

```
giis_signer/
├── gui/                        # GUI модуль приложения
│   ├── __init__.py             # Инициализация GUI модуля
│   ├── app.py                  # Главное окно приложения
│   ├── certificate_dialog.py   # Диалог выбора сертификата
│   ├── certificate_manager.py  # Менеджер сертификатов для GUI
│   └── config.py               # Сохранение настроек приложения
├── __init__.py                 # Инициализация пакета, публичный API
├── cli.py                      # CLI интерфейс, точка входа команды giis-signer
├── cryptopro_signer.py         # Интеграция с КриптоПро CSP через COM
├── diagnostics.py              # Утилиты диагностики и проверки подписей
└── xml_signer.py               # Формирование XMLDSig подписи
```

### Описание файлов пакета

#### `__init__.py`
- Экспортирует публичный API пакета
- Определяет `__version__`, `__author__`, `__license__`
- Экспортирует классы: `CryptoProSigner`, `XMLSigner`, `SignatureChecker`
- Экспортирует функции: `check_cryptopro_available`, `list_certificates`, `check_signature`

#### `cli.py`
- Реализует интерфейс командной строки
- Entry point: `giis-signer` (определен в pyproject.toml)
- Парсинг аргументов через argparse
- Обработка ошибок и вывод результатов

#### `cryptopro_signer.py`
- Класс `CryptoProSigner` - основной класс для работы с КриптоПро
- Класс `CryptoProException` - исключения при работе с КриптоПро
- COM-интерфейс к КриптоПро CSP
- Поиск сертификатов, подписание, хеширование по ГОСТ

#### `diagnostics.py`
- Класс `SignatureChecker` - проверка XML-подписей
- Функции диагностики: проверка КриптоПро, список сертификатов
- Валидация структуры подписи и DigestValue
- Может использоваться как модуль: `python -m giis_signer.diagnostics`

#### `xml_signer.py`
- Класс `XMLSigner` - формирование XMLDSig подписи
- Класс `XMLSignerException` - исключения при подписании
- Реализация алгоритма подписания (ExcC14N → SMEV → подпись)
- Вставка подписи в SOAP документы

## Пакет giis_signer/gui/

GUI модуль приложения на основе CustomTkinter.

### Описание файлов GUI модуля

#### `__init__.py`
- Экспортирует публичный API GUI модуля
- Основные экспорты: `GIISSignerApp`, `main`, `CertificateManager`, `Config`

#### `app.py`
- Класс `GIISSignerApp` - главное окно приложения
- Функция `main()` - точка входа GUI приложения
- Entry point: `giis-signer-gui` (определен в pyproject.toml)
- Двухпанельный интерфейс: входной XML | подписанный XML
- Кнопки импорта/экспорта, очистки, копирования
- Интеграция с CertificateDialog для выбора сертификата
- Автосохранение настроек при закрытии

#### `certificate_dialog.py`
- Класс `CertificateDialog` - диалоговое окно выбора сертификата
- Список всех сертификатов из хранилища Windows
- Отображение подробной информации о сертификате
- Индикация действительности сертификата (зеленый/красный)
- Кнопка "Обновить" для перезагрузки списка

#### `certificate_manager.py`
- Класс `CertificateManager` - управление сертификатами
- Класс `CertificateInfo` (dataclass) - информация о сертификате
- Получение списка сертификатов из хранилища Windows
- Кэширование списка сертификатов
- Форматирование отображаемых имен (CN + последние 8 символов thumbprint)
- Проверка действительности сертификатов

#### `config.py`
- Класс `Config` - менеджер конфигурации
- Сохранение настроек в JSON файл (%APPDATA%/giis-signer/config.json)
- Сохраняемые параметры:
  - `last_certificate_thumbprint` - последний выбранный сертификат
  - `window_geometry` - размер и позиция окна
  - `theme` - тема оформления (dark/light/system)
  - `last_input_dir` - последняя директория для импорта
  - `last_output_dir` - последняя директория для экспорта

#### `toast.py`
- Класс `Toast` - отдельное уведомление
- Класс `ToastManager` - менеджер уведомлений
- Неблокирующие push-уведомления в правом верхнем углу
- Четыре типа: success (✅ зеленые #28a745), info (ℹ️ голубые #17a2b8), warning (⚠️ желтые #ffc107), error (❌ красные #dc3545)
- Автоматическое исчезновение через заданное время (3-5 секунд)
- Вертикальное расположение (сверху вниз, новые наверху)
- Ограничение на 3 уведомления одновременно
- Автоматическое перепозиционирование при удалении

## Директория docs/

Документация проекта в формате Markdown.

```
docs/
├── CHANGELOG.md                # История версионных изменений
├── CLASSES.md                  # Структура классов проекта
├── CRYPTOPRO_COM.md            # Документация COM-интерфейса КриптоПро
├── FILES.md                    # Этот файл - файловая структура
├── TECH.md                     # Технологический стек и архитектура
├── TRANSIT.md                  # Промежуточный контекст разработки
└── Эталонный алгоритм СМЭВ3 на java.md  # Эталонная реализация СМЭВ
```

### Описание документов

#### `CHANGELOG.md`
- Формат: [Keep a Changelog](https://keepachangelog.com/)
- Версионирование: [Semantic Versioning](https://semver.org/)
- История всех значимых изменений проекта

#### `CLASSES.md`
- Полное описание всех классов
- Методы и их сигнатуры
- Зависимости между классами
- Диаграммы взаимодействия

#### `CRYPTOPRO_COM.md`
- Документация COM-интерфейса КриптоПро CSP
- Константы CAPICOM и CADESCOM
- Примеры использования
- Известные проблемы и решения

#### `FILES.md`
- Этот файл
- Полная структура директорий и файлов
- Назначение каждого файла

#### `TECH.md`
- Архитектурные принципы
- Технологический стек
- Правила стилизации кода
- Рекомендации по разработке

#### `TRANSIT.md` (ранее DEVELOPMENT.md)
- Промежуточный контекст разработки
- Текущее состояние проекта
- История решенных проблем
- Критические технические детали

#### `Эталонный алгоритм СМЭВ3 на java.md`
- Эталонная Java-реализация СМЭВ-трансформации
- Используется как справочник

## Директория examples/

Примеры XML-шаблонов и результатов подписания.

```
examples/
├── template.xml                # Базовый SOAP-шаблон для подписания
└── signed.xml                  # Пример подписанного документа
```

### Описание примеров

#### `template.xml`
- Базовый SOAP-шаблон с элементом `id="body"`
- Пустой элемент `<ns:CallerSignature>` для вставки подписи
- Готов к использованию с командой `giis-signer`

#### `signed.xml`
- Результат подписания template.xml
- Содержит полную структуру XMLDSig подписи
- Может использоваться для тестирования

## Конфигурационные файлы

### `pyproject.toml`
**Назначение:** Современная конфигурация Python проекта (PEP 518/621)

**Содержимое:**
- `[project]` - метаданные проекта (имя, версия, описание, авторы)
- `dependencies` - runtime зависимости (pywin32, lxml, xmlcanon, smev-transform)
- `[project.optional-dependencies]` - dev зависимости (pytest, black, flake8, mypy)
- `[project.scripts]` - entry points (giis-signer = giis_signer.cli:main)
- `[tool.setuptools]` - конфигурация setuptools (packages)
- `[tool.black]` - настройки форматирования кода
- `[tool.mypy]` - настройки статической типизации

### `uv.lock`
**Назначение:** Lockfile для uv package manager

**Содержимое:**
- Точные версии всех зависимостей и под-зависимостей
- Хеши пакетов для проверки целостности
- Автоматически генерируется при `uv sync`

### `.gitignore`
**Назначение:** Исключения для Git

**Основные исключения:**
- `CLAUDE.md` - инструкции для AI
- `.claude/` - директория настроек Claude
- `__pycache__/` - кэш Python
- `*.pyc` - скомпилированные файлы
- `.venv/` - виртуальное окружение
- `*.egg-info/` - метаданные установки
- Другие служебные файлы

### `LICENSE`
**Назначение:** MIT лицензия

**Содержимое:**
- Текст лицензии MIT
- Разрешения на использование, копирование, модификацию
- Отказ от ответственности

## Метаданные и документация

### `README.md`
**Назначение:** Основная документация проекта

**Разделы:**
- Особенности проекта
- Требования (системные и Python)
- Установка (КриптоПро CSP + утилита)
- Использование (CLI и как библиотека)
- Формат SOAP-документа
- Алгоритм подписания
- Поддерживаемые алгоритмы
- Отладка и диагностика
- Устранение неполадок
- Благодарности

### `CLAUDE.md`
**Назначение:** Инструкции для Claude AI помощника

**Содержимое:**
- Описание окружения (OS, язык, менеджер пакетов)
- Начало работы (создание venv, установка зависимостей)
- Принципы документирования
- Файлы документации и их назначение
- Правила работы с Git
- Документация по uv package manager

### `smev_readme.md`
**Назначение:** Документация по smev-transform пакету

**Содержимое:**
- Описание SMEV Transform v2.0
- Полный алгоритм трансформации (9 шагов)
- Установка и использование
- Примеры
- Различия с PHP версией
- Ссылки на PyPI и GitHub

## Устаревшие файлы

### `main.py`
**Статус:** Устарел, сохранен для обратной совместимости

**Рекомендация:** Использовать `giis-signer` CLI команду вместо прямого запуска

## Генерируемые файлы/директории

### `.venv/`
Виртуальное окружение Python, создается командой `uv venv`

### `__pycache__/`
Кэш скомпилированных Python модулей, генерируется автоматически

### `giis_signer.egg-info/`
Метаданные установленного пакета, генерируется при `uv sync` или `pip install -e .`

---

## Правила организации файлов

1. **Код:** Весь исполняемый код находится в пакете `giis_signer/`
2. **Документация:** Вся документация в директории `docs/`
3. **Примеры:** Все примеры в директории `examples/`
4. **Конфигурация:** Корневая директория для конфигурационных файлов
5. **Генерируемые:** Добавлены в `.gitignore`, не коммитятся

## Рекомендации по структуре

### Добавление нового модуля
Новые модули добавляются в директорию `giis_signer/`:
```
giis_signer/
└── new_module.py              # Новый модуль
```

Обязательно:
1. Обновить `__init__.py` для экспорта публичного API
2. Обновить `docs/CLASSES.md` с описанием новых классов
3. Обновить `docs/FILES.md` (этот файл)
4. Добавить тесты (если есть директория tests/)

### Добавление документации
Новые документы добавляются в `docs/`:
```
docs/
└── NEW_DOCUMENT.md            # Новый документ
```

### Добавление примеров
Новые примеры добавляются в `examples/`:
```
examples/
└── new_example.xml            # Новый пример
```

---

**Последнее обновление:** 2025-10-01
**Версия проекта:** 1.0.0
